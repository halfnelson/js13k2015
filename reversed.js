"use strict";function $s(t){return document.querySelectorAll(t).item(0)}function $(t){return document.getElementById(t)}function n$(t){return document.createElement(t)}function game(t){function e(t,e){for(var a=null,n=0;n<t.length;n++)if(a=e(t[n],n))return a}function a(){function t(t,e,a,n,r){for(var i=[],o=0;r>o;o++)i.push([a+o*n,e,t]);return i}var e=C.G,a=[];a=a.concat(t(e.J,1.25,0,S,5)),a=a.concat(t(e.H,-1.25,15*S,S,5));var n=t(e.K,2,0,2*S,20),r=[[S,0,e.M]],i=[[S,0,e.R]],o=t(e.L,0,S/2,S,20);o=o.concat(t(e.L,-1,S/2,S,20)),o=o.concat(t(e.L,1,S/2,S,20));var l=function(a,n,r){return t(e.P,a,n*S,S,r)},c=C.U,f=C.S;return new C([new x(f.T,20,a.concat(l(.75,2,10)).concat(i),c.V,!1),new x(f.left,20,n.concat(l(-.25,5,5)),c.W,!1),new x(f.T,10,n.concat(r),c.W,!1),new x(f.T,20,o.concat(l(-.75,10,5)),c.V,!0),new x(f.T,10,n,c.X,!1),new x(f.left,20,n.concat(l(0,2,5)).concat(r),c.V,!1),new x(f.right,20,n,c.X,!1),new x(f.T,20,a.concat(l(.25,4,5)).concat(r),c.W,!1),new x(f.right,20,a,c.W,!1)])}function n(t,e,a,n,r,i,o){return{x:t,Y:e,Z:a,color:n,acceleration:r,$:i,_:o,direction:0,speed:0,aa:0,reversed:!1,ba:!1,ca:!1,da:!0,ea:0,fa:0}}function r(){function e(t,e){var a=n$("canvas");return a.width=t,a.height=e,a}function a(t,e,a){t.fillStyle=e,t.beginPath(),t.moveTo(a[0],I),t.lineTo(a[1],vt),t.lineTo(a[2],vt),t.lineTo(a[3],I),t.fill()}function n(t,e,n,r){var i=r*at*D,o=r*et*D,l=D/2+(n*et*D-o/2),c=D/2+(n*at*D-i/2),f=c+i,u=l+o;a(t,e,[l,c,f,u])}function r(t,a,r,i,o,l){var c=e(D,I),f=c.getContext("2d");return f.rect(0,0,D,I),f.fillStyle=t,f.fill(),n(f,a,0,1),n(f,r,.5,nt),n(f,r,-.5,nt),n(f,i,.25,rt),n(f,i,0,rt),n(f,i,-.25,rt),l&&l(f),o&&(f.save(),f.translate(0,I),f.scale(1,-1),f.drawImage(o,0,0,k,vt,0,0,D,I/2),f.restore()),c}function i(t,e,a,r){for(var i=1/r,o=0;i>o;o++)n(t,o%2==0?e:a,-.5+r*o,r)}function o(t,a){var n=e(et*D,I),r=n.getContext("2d");return r.fillStyle=t?"#CCCCCC":"black",r.fillRect(0,0,n.width,a?I:I/3),n}function l(){var t=50,a=e(t,2*I/3),n=a.getContext("2d");return n.fillStyle="yellow",n.beginPath(),n.arc(t/2,0,t/2,0,Math.PI),n.fill(),a}function c(t,a,n,r,i,o,l){var c=e(t,a+n),f=c.getContext("2d");return f.fillStyle="#DDD",f.fillRect(o*t-2,0,4,a+n),f.fillRect((1-o)*t-2,0,4,a+n),f.fillStyle=i,f.fillRect(0,0,t,a),f.fillStyle=r,f.fillRect(2,2,t-4,a-4),l&&l(f),c}function f(t,e,a,n,r,i,o,l){return c(t,e,a,n,r,l,function(a){var n=.85*e;a.font=n+"px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle=o,a.fillText(i,t/2,e/2,t)})}function u(t){var a=e(t.width,t.height),n=a.getContext("2d");return n.drawImage(t,0,0,t.width,t.height,0,0,t.width,t.height),n.globalCompositeOperation="source-atop",n.fillStyle="rgba(255,255,255,1.0)",n.fillRect(0,0,a.width,a.height),a}function d(t,a,n){var r=e(k,vt),i=r.getContext("2d"),o=(1-n)*vt,l=n*vt,c=i.createLinearGradient(0,l,0,l+o);return c.addColorStop(0,t),c.addColorStop(1,a),i.fillStyle=c,i.fillRect(0,0,k,vt),r}function s(t){for(var e=t.getContext("2d"),a=e.getImageData(0,0,1,vt),n=[],r=0;vt>r;r++)n.push(a.data[4*r+3]);return n}function h(t,a,n){var r=e(D,I),i=r.getContext("2d");i.fillStyle=t,i.fillRect(0,0,D,I),i.fillStyle=a,i.fillRect(0,I/2+5,D,I/2),i.fillStyle="white";for(var o=[[.25*D,1/6*I,.35],[.5*D,.25*I,.25],[.75*D,.2*I,.3],[1*D,1/8*I,.2]],l=0;l<o.length;l++)i.font=I*o[l][2]+"px Arial",i.fillText("\u2601",o[l][0],o[l][1]+30);return n&&(i.drawImage(n,0,0,k,vt,0,0,D,I-vt+5),i.drawImage(n,0,vt-1,k,1,0,I/2+5,D,I/2)),r}function g(t,a){var n=e(t.naturalWidth||t.width,t.naturalHeight||t.height),r=n.getContext("2d");return r.globalAlpha=a,r.drawImage(t,0,0),n}function v(t){var a=e(t.naturalWidth||t.width,t.naturalHeight||t.height),n=a.getContext("2d");return n.ga=!1,n.translate(t.width,0),n.scale(-1,1),n.drawImage(t,.5,0),a}function p(t){for(var e=[],a=50,n=8,r=t;r>0;r--)e.push(a*n/r);return e}function w(t,a,n,r){var i=e(a,n),o=i.getContext("2d");return o.beginPath(),o.fillStyle=r,o.font="normal normal bold "+.75*n+"px Arial",o.textAlign="center",o.textBaseline="middle",o.shadowColor="rgba(40,40,40,0.8)",o.shadowOffsetX=4,o.shadowOffsetY=4,o.fillText(t,a/2,n/2,a),i}function m(){var t=0>T?D+T:T,e=Math.min(k,D-t);K.drawImage(ut,t,0,e,I,0,0,e,I),k>e&&K.drawImage(ut,0,0,k-e,I,e,0,k-e,I)}function y(t,e,a,n,r,i){return{ha:t,C:r,x:e,y:a,z:n,ia:i}}function b(t,e,a){for(var n=e,r=t,i=0,o=0,l=0,c=0,f=0,u=L.A[r],d=0,s=-1,h=[],g=.005,v=1,p=-1*a*(et/2*D),w=0,m=0,b=0,C=0,M=!1,A=!1,$=!1,T=null,B=0,Y=0;vt>Y&&(B=(pt[Y]||-1)+n,0>s&&(s=B-(pt[1]-pt[0])),!(B-n>80));Y+=1){M=!1,A=!1;var E=L.D(r,B),q=L.A[E.C];if(q!=u&&(i=Y,o=d,c=f*(B-s),q.u&&!u.u&&(M=!0),l=B-E.F),q.u&&vt>Y+1){var Z=L.B(r,(pt[Y+1]||-1)+n);L.A[Z].u||(A=!0)}g=q.t,m=m+v+100*g*(s-B),f=q.p;var F=(1-Y/vt)*p;C=C+f*(s-B)-c;var P=C+F;if(!(0>B)){var G=Math.floor(B/S)%2==0,_=q.u?G?ct:ft:G?ot:lt;Math.ceil(m-w)>0&&(K.beginPath(),K.drawImage(_,D/2-k/2+P,I-Math.floor(Y),k,1,0,I-Math.floor(m),k,Math.ceil(m-w)+.5),w=m,b=B);var O=(Y-vt-at/et*Y)/vt,H=q.s;for(j=0;j<H.length;j++)H[j][0]>s-l&&H[j][0]<=B-l&&h.unshift(y(mt[H[j][2].id],-1*P+H[j][1]*(D/2)*O*et,m,B,O,Y));for(j=0;j<R.length;j++)L.A[R[j].Y]==q&&R[j].Z>s-l&&R[j].Z<=B-l&&h.unshift(y(x(R[j]),-1*P+R[j].x*(D/2)*O*et,m,B,O,Y));M&&($=!1,T=y(ht,-1*P,m,B,O,Y),h.unshift(T)),A&&($=!0,h.unshift(y(st,-1*P,m,B,O,Y))),u=q,d=C,s=B}}K.save(),K.beginPath(),K.rect(0,0,k,I-Math.floor(w)),K.clip();var U=L.A[r].u;$||(U||T)&&h.unshift(y(gt,0,w,B,(-1-at/et*(vt-1))/vt));for(var W=!1,j=0;j<h.length;j++){var X=h[j];if(X.ha&&X.ha.g){X.z<b&&(W=!0,K.restore(),K.beginPath());var z=X.ha.g.width,N=X.ha.g.height,V=z*X.C,J=N*X.C;if(K.drawImage(X.ha.g,0,0,z,N,k/2+X.x-V/2+V,I-X.y+J,-1*V,-1*J),X.ha.ja){var Q=dt[X.ia]/255;K.save(),K.globalAlpha=Q,K.drawImage(X.ha.ja,0,0,z,N,k/2+X.x-V/2+V,I-X.y+J,-1*V,-1*J),K.restore()}if((X.ha==st||X.ha==ht||X.ha==gt)&&(K.beginPath(),K.fillStyle=X.ha==ht?"#cccccc":"black",K.fillRect(0,I-X.y+1,k/2+X.x+V/2+1,J-1),K.fillRect(k/2+X.x-V/2-1,I-X.y+1,k-(k/2+X.x-V/2),J-1),U&&K.fillRect(0,0,k,I-(I-X.y)+3),T&&X.ha!=ht)){var tt=T.ha.g.height*T.C;K.fillRect(0,I-T.y+tt,k,I-X.y-(I-T.y+tt)+2)}}}W||K.restore()}function x(t){var e=V[t.color];return-1==t.direction&&(e=Q[t.color]),1==t.direction&&(e=J[t.color]),t.ka&&(e=tt[t.color]),e}function M(){var t=x(q);K.drawImage(t.g,Math.floor(k/2-t.g.width/2)+.5,I-t.g.height-15)}function A(){K.beginPath(),K.save(),K.font="15px Arial Black",K.shadowColor="rgba(40,40,40,0.8)",K.fillStyle="#CCC",K.shadowOffsetX=1,K.shadowOffsetY=1,K.fillText("Speed: ",k/50,I/20,k/10),K.fillText("Lap: ",17*k/20,I/20,k/10),K.shadowColor="rgba(40,40,40,0.8)",K.shadowOffsetX=2,K.shadowOffsetY=2,K.font="20px Arial Black",K.fillStyle="white",K.fillText(Math.floor(200*q.speed/q._)+" kph",k/50,2*I/20),K.fillText(q.aa+" of "+G,17*k/20,2*I/20),K.restore()}function B(t,a,n){var r=$s("#"+t+" svg").cloneNode(!0);a&&a(r);var i=(new XMLSerializer).serializeToString(r),o="data:image/svg+xml;base64,"+btoa(i),l=new Image;l.addEventListener("load",function(){l.height=l.naturalHeight,l.width=l.naturalWidth;var t=e(l.width,l.height),a=t.getContext("2d");a.drawImage(l,0,0),n(t)}),l.setAttribute("src",o)}function Y(t,e,a){for(var n=t.querySelectorAll("*[fill='"+e+"']"),r=0;r<n.length;r++)n[r].style.fill=a}function E(t,e){for(var a=0;a<e.length;a++)Y(t,e[a][0],e[a][1])}function Z(t){E(t,[["#f2f2f2","#00f200"],["#e6e6e6","#00e600"],["#cccccc","#00cc00"],["#b3b3b3","#00b300"]])}function F(t){E(t,[["#f2f2f2","#0000f2"],["#e6e6e6","#0000e6"],["#cccccc","#0000cc"],["#b3b3b3","#0000b3"]])}function P(t){E(t,[["#f2f2f2","#f20000"],["#e6e6e6","#e60000"],["#cccccc","#cc0000"],["#b3b3b3","#b30000"]])}function _(t){E(t,[["#f2f2f2","#f2f200"],["#e6e6e6","#e6e600"],["#cccccc","#cccc00"],["#b3b3b3","#b3b300"]])}function O(){m(),b(q.Y,q.Z,q.x),M(),A()}function H(){m(),b(0,0,0);var t=e(z.width,z.height),a=t.getContext("2d");return a.drawImage(z,0,0),t}function U(t,a,n){var r=e(50,50),i=$(t),o=r.getContext("2d");o.drawImage(i,0,0,50,50);var l=e(a,n);return o=l.getContext("2d"),o.drawImage(r,0,0,a,n),l}function W(){N-=1,0>=N&&t()}function j(t){return{g:t,ja:u(t)}}function X(t){t||(t="city"),et=.5,at=.04/3,nt=.025,rt=.015,"city"==t?(it=d("rgba(255,255,255,0)","rgba(255,255,255,0.25)",.25),ot=r("#224400","#314430","white","white",it),lt=r("#325611","#435443","#314430","#435443",it),ct=r("black","#314430","white","white"),ft=r("black","#435443","#314430","#435443"),ut=h("blue","#325611",it),mt[wt.K.id]=j(U("deciduous",360,360))):"desert"==t?(it=d("rgba(237,204,169,0)","rgba(237,204,169,0.45)",.15),ot=r("#E4BE9F","#C89B7E","#9C664C","#C89B7E",it,function(t){i(t,"rgba(0,0,0,0)","#D3A281",nt)}),lt=r("#C89B7E","#D3A281","#9C664C","#D3A281",it,function(t){i(t,"rgba(0,0,0,0)","#C89B7E",nt)}),ct=r("black","#314430","white","white"),ft=r("black","#435443","#314430","#435443"),ut=h("blue","#325611",it),mt[wt.K.id]=j(U("cactus",260,260))):"snow"==t&&(it=d("rgba(255,255,255,0)","rgba(255,255,255,0.45)",.15),ot=r("#C5D6FF","#ADBBE9","#9097B4","#ADBBE9",it),lt=r("#EFE7F3","#CDCCD3","#9097B4","#CDCCD3",it),ct=r("black","#314430","white","white"),ft=r("black","#435443","#314430","#435443"),ut=h("#5F6F90","#ADBBE9",it),mt[wt.K.id]=j(U("evergreen",360,360))),mt[wt.H.id]=j(f(160,160,45,"yellow","black","\u2691","black",.25)),mt[wt.J.id]=j(f(160,160,45,"white","black","\u26a0","red",.25)),mt[wt.R.id]=j(c(et*k*3*1.1,100,300,"red","red",.05,function(t){var e=65;t.font=e+"px 'Arial Black'",t.textAlign="center",t.fillStyle="white",t.fillText("\ud83c\udfc1 START \ud83c\udfc1",et*k*3*1.1/2,50+e/4)})),mt[wt.M.id]=j(c(et*k*3*1.1,100,300,"white","white",.05,function(t){var e=65;t.font=e+"px 'Arial Black'",t.textAlign="center",t.fillStyle="black",t.fillText("\ud83d\udd53 CHECKPOINT \ud83d\udd53",et*k*3*1.1/2,50+e/4)})),mt[wt.L.id]={g:l()};var e=et*D*wt.P.width;mt[wt.P.id]=j(w("\u2605",e,e,"orange")),st={g:o()},ht={g:o(!0)},gt={g:o(!1,!0)},dt=s(it)}var z=$("c"),K=z.getContext("2d");z.width=k,z.height=I,K.fontsize=15,K.translate(.5,.5);var N=0,V={},J={},Q={},tt={};[["red",P],["green",Z],["blue",F],["grey",null],["yellow",_]].forEach(function(t){N++,B("cr",t[1],function(e){V[t[0]]=j(e),tt[t[0]]=j(g(e,.2)),W()}),N++,B("crt",t[1],function(e){J[t[0]]=j(e),Q[t[0]]=j(v(e)),W()})});var et,at,nt,rt,it,ot,lt,ct,ft,ut,dt,st,ht,gt,vt=I/2,pt=p(vt),wt=C.G,mt={};return{la:O,ma:X,na:H,oa:V}}function i(t,e){var a=L.A[t.Y].direction();return a*t.$*(Math.pow(Math.min(t.speed,t._),3)/Math.pow(t._,3))*e*-1}function o(t,e,a){var n=L.D(t.Y,t.Z+e),r=v(n.C,n.F,a,t);return r&&(r.ha.da||r.ha[2].I)?r:!1}function l(t,e){if(!t.ka){t.ba?t.speed=t.speed+e*t.acceleration*(1-Math.pow(Math.abs(t.speed),1)/Math.pow(t._,1)):t.ca?t.speed=Math.max(t.speed-e*t.acceleration*(1+Math.pow(t.speed,2)/Math.pow(t._,2)),-1*t._/3):t.speed=t.speed>0?Math.max(t.speed-e*t.acceleration/3,0):Math.min(t.speed+e*t.acceleration/3,0);var a=0;0!=t.direction&&(a=(t.reversed?1:-1)*t.direction*t.$*(Math.min(t.speed,t._)/t._)*e)}var n=t.Z;if(t.Z=n+t.speed*e,t.ka&&t.Y==t.fa){if(t.Z<=t.ea||n<=t.ea){t.Z=t.ea,t.speed=0;var r=g(t);if(r)return;return void(t.ka=!1)}t.speed=(t.Z-t.ea)/L.A[t.Y].v()*t._*2*-1-t._/20}var l=L.D(t.Y,t.Z);0==l.C&&t.Y==L.A.length-1&&t.aa++,t.Y=l.C,t.Z=l.F;var c=i(t,e);if(!t.ka)if(t.pa){t.x==t.qa&&(t.qa=void 0);var f=t.$,u=S/2+S*(t.speed/t._),d=o(t,u,t.x);if(d){var s=d.ha.da?.4:d.ha[2].width;t.qa=t.x+d.ra,(t.qa<-.75||t.qa>.75||o(t,u/2,t.qa))&&(t.qa=t.x+(d.ra>0?-s:s)+(d.ra+(d>0?-s:s)),(t.qa<-.75||t.qa>.75||o(t,u/2,t.qa))&&(t.qa=void 0,t.ba=!1,t.ca=!0))}else t.ca=!1,t.ba=!0;if(void 0!==t.qa){var h=Math.min(Math.abs(t.qa-t.x),f);t.qa<t.x?t.x=t.x-h*e:t.x=t.x+h*e}}else t.x=Math.max(Math.min(t.x+a-c,1),-1);if(!t.ka&&0!=t.speed){var v=g(t);if(v){var p=v.ha;if(p.da)t.ka=!0,t.speed=-1*t._*5,t.x=1.5*Math.random()-.75,t.qa=void 0;else if(p[2].id==C.G.P.id)t.speed=1.1*t.speed,p[2]=C.G.O,setTimeout(function(){p[2]=C.G.P},B);else if(p[2].id==C.G.M.id||p[2].id==C.G.R.id){var w=L.D(t.Y,p[0]-S);t.fa=w.C,t.ea=w.F}else{t.x=t.x+1.1*v.ra,t.Z=t.Z+v.sa;var m=L.D(t.Y,t.Z);t.Y=m.C,t.Z=m.F,t.speed=.9*t.speed}}}}function c(t){for(var e=0;e<R.length;e++)l(R[e],t)}function f(t,e){if(t.aa<e.aa)return!0;if(t.aa==e.aa){if(t.Y<e.Y)return!0;if(t.Y==e.Y&&t.Z<e.Z)return!0}return!1}function u(t){for(var e=1,a=0;a<R.length;a++)t!=R[a]&&f(t,R[a])&&(e+=1);return t!=q&&f(t,q)&&(e+=1),e}function d(t){if(!_){M||(M=t);var e=t-M,a=e/P;if(M=t,!focused)return void requestAnimationFrame(d);if(p(),l(q,a),!q.pa&&q.aa>G){var n=(performance.now()-A)/1e3,r=Math.floor(n/60),o=n-60*r;q.pa=!0,q.ba=!0,R.push(q),$("finished").style.display="block",$("time").innerHTML=r+"m "+o.toFixed(2)+"s",$("laps").innerHTML=G,$("pos").innerHTML=u(q)+" of "+R.length}c(a),T=(T+-1*i(q,a)*(D/3)/3)%D,F.la(),requestAnimationFrame(d)}}function s(t){for(var e=[],a=0;t>a;a++){var r=n(-3/4+(a%4>1?.5:0)+a%2,0,Math.floor(a/2)*(S/2),"grey",.0015*Math.random()+.0035,.065,Math.random()*(.75-.6)+.6);r.pa=!0,r.ba=!0,e.push(r)}return e}function h(t,e,a,n,r,i,o){var l=0,c=0,f=!1,u=!1;n>=t&&t+S/2>=n&&(l=-1*(t+S/2-n),u=!0);var d=e-a/2,s=e+a/2,h=r-i/2,g=r+i/2;return g>d&&s>h&&(c=Math.abs(g-d)<Math.abs(s-h)?g-d:-1*(s-h),f=!0),f&&u?{ra:c,sa:l,ha:o}:null}function g(t){return v(t.Y,t.Z,t.x,t)}function v(t,a,n,r){var i,o=.4,l=a,c=n,f=o;if(i=e(R,function(e){return e!=r&&!e.ka&&e.Y==t&&h(l,c,f,e.Z,e.x,.25,e)}),r==q||t!=q.Y||q.ka||(i=h(l,c,f,q.Z,q.x,o,q)),i)return i;var u=L.A[t];return i=e(u.s,function(t){return t[2].width&&t[2].id!=C.G.O&&h(l,c,f,t[0],t[1],t[2].width,t)})}function p(){q.direction=0,(Z.Right||Z.ArrowRight)&&(q.direction=1),(Z.Left||Z.ArrowLeft)&&(q.direction=-1),(Z.Up||Z.ArrowUp)&&(q.ba=!0,q.ca=!1),(Z.Down||Z.ArrowDown)&&(q.ba=!1,q.ca=!0),Z.Down||Z.Up||Z.ArrowDown||Z.ArrowUp||(q.ca=!1,q.ba=!1)}function w(){document.removeEventListener("keyup",m),document.removeEventListener("keydown",y),_=!0}function m(t){var e=t.key||t.keyIdentifier;Z[e]=!1}function y(t){var e=t.key||t.keyIdentifier;return Z[e]=!0,t.preventDefault(),!1}function b(t,e,a){F.ma(a),q=n(-.75,E.C,E.F,t,.005,.0208,.8),G=e,document.addEventListener("keyup",m),document.addEventListener("keydown",y),R=s(Y),F.la();var r=$s(".countdown");$s(".countdown").style.display="block";var i=r.cloneNode(!0);r.parentNode.replaceChild(i,r),window.setTimeout(function(){$s(".countdown").style.display="none",A=performance.now(),_=!1,requestAnimationFrame(d)},4100)}var x=function(t,e,a,n,r){this.p=t,this.q=e,this.s=a,this.t=n,this.u=r};x.prototype.direction=function(){var t=this.p;return 0==t?0:t/Math.abs(t)},x.prototype.v=function(){return this.q*S};var C=function(t){this.A=t};C.prototype.B=function(t,e){return this.D(t,e).C},C.prototype.D=function(t,e){for(;;){var a=this.A[t];if(e>a.v())e-=a.v(),t++,t>=this.A.length&&(t=0);else{if(!(0>e))return{C:t,F:e};t--,0>t&&(t=this.A.length-1),e=this.A[t].v()+e}}},C.G={H:{id:0,width:.5,I:!0},J:{id:1,width:.5,I:!0},K:{id:2,width:.15,I:!0},L:{id:3},M:{id:4,width:2},N:{id:5,width:.2,item:!0},O:{id:6},P:{id:7,width:.125,item:!0},R:{id:8,width:2}},C.S={left:-2,right:2,T:0},C.U={V:0,W:.005,X:-.005};var M,A,k=640,I=400,D=3*k,S=5,T=0,B=2e3,L=a(),Y=40,E=L.D(0,-1*S),R={},q=n(-.75,E.C,E.F,"red",.005,.0208,.8),Z={},F=r(),P=1e3/60,G=10,_=!1;return{start:b,ta:F,stop:w}}function playMusic(){audio.play(),audio.loop=!0}function stopMusic(){audio.pause()}function main(){state.ua=game(function(){var t=state.ua;t.ta.ma("city");var e=t.ta.na();t.ta.ma("desert");var a=t.ta.na();t.ta.ma("snow");var n=t.ta.na();$s("#colorRed + label").appendChild(t.ta.oa.red.g),$s("#colorGreen + label").appendChild(t.ta.oa.green.g),$s("#colorBlue + label").appendChild(t.ta.oa.blue.g),$s("#colorYellow + label").appendChild(t.ta.oa.yellow.g),$s("#typecity + label").appendChild(e),$s("#typedesert + label").appendChild(a),$s("#typesnow + label").appendChild(n),$s(".menu").style.display="block",$("loader").style.display="none";var r=$("toggleMusic");r.addEventListener("click",function(){var t=r.classList;t.contains("muted")?(playMusic(),t.remove("muted")):(t.add("muted"),stopMusic())})})}function startGame(){var t=$s("input[name='color']:checked").value,e=parseInt($s("input[name='laps']:checked").value),a=$s("input[name='type']:checked").value;console.log(t,e,a),state.ua.start(t,e,a),$s(".menu").style.display="none",$("toggleMusic").classList.contains("muted")||playMusic()}function restartGame(){state.ua.stop(),$("finished").style.display="none",$("loader").style.display="block",state.ua=game(function(){$("loader").style.display="none",$s(".menu").style.display="block"})}function resize(){var t=$s(".gs");"960px"!=t.style.width?(t.style.width="960px",t.style.height="600px"):(t.style.width="640px",t.style.height="400px")}var CPlayer=function(){var t,e,a,n,r,i=function(t){return Math.sin(6.283184*t)},o=function(t){return 2*(t%1)-1},l=function(t){return.5>t%1?1:-1},c=function(t){var e=t%1*4;return 2>e?e-1:3-e},f=function(t){return.003959503758*Math.pow(2,(t-128)/12)},u=function(t,e,a){var n,r,i,o,l,c,u,s=d[t.g[0]],h=t.g[1],g=t.g[3],v=d[t.g[4]],p=t.g[5],w=t.g[8],m=t.g[9],y=t.g[10]*t.g[10]*4,b=t.g[11]*t.g[11]*4,x=t.g[12]*t.g[12]*4,C=1/x,M=t.g[13],A=a*Math.pow(2,2-t.g[14]),k=new Int32Array(y+b+x),$=0,I=0;for(n=0,r=0;y+b+x>n;n++,r++)r>=0&&(M=M>>8|(255&M)<<4,r-=A,c=f(e+(15&M)+t.g[2]-128),u=f(e+(15&M)+t.g[6]-128)*(1+8e-4*t.g[7])),i=1,y>n?i=n/y:n>=y+b&&(i-=(n-y-b)*C),o=c,g&&(o*=i*i),$+=o,l=s($)*h,o=u,w&&(o*=i*i),I+=o,l+=v(I)*p,m&&(l+=(2*Math.random()-1)*m),k[n]=80*l*i|0;return k},d=[i,l,o,c];this.init=function(i){t=i,e=i.h-2,a=0,n=i.i*i.j*(e+1)*2,r=new Int32Array(n)},this.k=function(){var o,l,c,f,s,h,g,v,p,w,m,y,b,x,C=new Int32Array(n),M=t.l[a],A=t.i,k=t.j,$=0,I=0,D=!1,S=[];for(c=0;e>=c;++c)for(g=M.m[c],f=0;k>f;++f){var T=g?M.c[g-1].f[f]:0;T&&(M.g[T-1]=M.c[g-1].f[f+k]||0,15>T&&(S=[]));var B=d[M.g[15]],L=M.g[16]/512,Y=Math.pow(2,M.g[17]-9)/A,E=M.g[18],R=M.g[19],q=43.23529*M.g[20]*3.141592/44100,Z=1-M.g[21]/255,F=1e-5*M.g[22],P=M.g[23]/32,G=M.g[24]/512,_=6.283184*Math.pow(2,M.g[25]-9)/A,O=M.g[26]/255,H=M.g[27]*A;for(m=(c*k+f)*A,s=0;4>s;++s)if(h=g?M.c[g-1].n[f+s*k]:0){S[h]||(S[h]=u(M,h,A));var U=S[h];for(l=0,o=2*m;l<U.length;l++,o+=2)C[o]+=U[l]}for(l=0;A>l;l++)v=2*(m+l),w=C[v],w||D?(y=q,E&&(y*=B(Y*v)*L+.5),y=1.5*Math.sin(y),$+=y*I,b=Z*(w-I)-$,I+=y*b,w=3==R?I:1==R?b:$,F&&(w*=F,w=1>w?w>-1?i(.25*w):-1:1,w/=F),w*=P,D=w*w>1e-5,p=Math.sin(_*v)*G+.5,x=w*(1-p),w*=p):x=0,v>=H&&(x+=C[v-H+1]*O,w+=C[v-H]*O),C[v]=0|x,C[v+1]=0|w,r[v]+=0|x,r[v+1]+=0|w}return a++,a/8},this.o=function(){var t=2*n-8,e=t-36,a=44,i=new Uint8Array(a+2*n);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var o=0,l=a;n>o;++o){var c=r[o];c=-32767>c?-32767:c>32767?32767:c,i[l++]=255&c,i[l++]=c>>8&255}return i},this.getData=function(t,e){for(var a=2*Math.floor(44100*t),n=new Array(e),i=0;2*e>i;i+=1){var o=a+i;n[i]=t>0&&o<r.length?r[o]/32768:0}return n}},song={l:[{g:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],m:[1,1,1,1,1,1,1,1,1,1,,,,,1,1,1],c:[{n:[149,,149,,,,,,156,,156,,,,,,147,,147,,,,,,151,151,151],f:[]}]},{g:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],m:[,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[139,,,,139,,,,139,,,,139,,,,139,,,,139,,,,139,,,,139],f:[]}]},{g:[0,0,140,0,0,0,140,0,0,60,4,10,34,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],m:[,,,,1,1,1,1,1,,,,,1,1,1,1],c:[{n:[,171,171,,,176,,,,171,171,,,176,,,,171,171,,,176,,,,171,171,,,176],f:[]}]},{g:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],m:[,,,,,,1,1,1,1,1,,,,,1,1],c:[{n:[144,,,144,,,,,152,,,152,,,,,120,,,120,,,,,128,,,128],f:[]}]},{g:[2,255,128,0,3,255,128,0,0,0,0,6,29,0,0,0,195,4,1,3,50,184,119,244,147,6,84,6],m:[,,,,,,,2,2,2,2,2,,,,,2,2],c:[{n:[152,,,,151,,,,164,,,,163,,,,159,,,,154,,,,166,,,,163],f:[]},{n:[156,,,,,,139,142,146,,,,,,,,,,149,,,,156,,,151,,,154,,,,,141,147,151,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,146,151,151],f:[]}]},{g:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],m:[],c:[]},{g:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],m:[],c:[]},{g:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],m:[],c:[]}],i:5513,j:32,h:19},audio=document.createElement("audio"),musicplayer=new CPlayer;for(musicplayer.init(song);musicplayer.k()<1;);var wave=musicplayer.o();audio.src=URL.createObjectURL(new Blob([wave],{type:"audio/wav"}));var state={ua:null},focused=!0;window.onfocus=function(){focused=!0},window.onblur=function(){focused=!1},window.addEventListener("load",main,!1);